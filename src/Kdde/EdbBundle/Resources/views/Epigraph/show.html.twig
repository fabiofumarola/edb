{% extends '::base_reduct.html.twig' %}

{% block header %}
	{{ parent() }}

	<!-- google maps v3 -->
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
  		#map_canvas { width:550px;height: 300px; margin-right: auto ;margin-left: auto ; }
	</style>
	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=true" ></script>
{% endblock %}

 {% block title %}
 EDB Show Epigraph
{% endblock %}

{% block body %}
{% include 'KddeEdbBundle:GeoPosition:modalViewGeoPosition.html.twig' %}
{% include 'KddeEdbBundle:Literature:modalSingleLiterature.html.twig' %}
	<br>
	<div class="marketing">
		<h4 style="text-align:left" >EDB{{ e.id }}</h4>
		<br>
	</div>
	<div class="row">
				{# <table class="table table-striped table-condensed"> #}
				<table class="table table-condensed tdnb" >
						{% if e.pertinence | length > 0 %}
{# 							// Loop each pertinence, excluding the incertae origin (id = 1)#}
							{% for c in e.pertinence if c.context.id != 1 %}
								<tr style = "font-size: 12pt">
									<td>
										{% if loop.index  == 1 %}
											<i style="color:grey;">Pertaining to </i> 
										{% else %}
											<i style="color:grey;">and </i> 
										{% endif %}
										{%- if c.context.description != 'n.d.'-%}
											<a onClick="showMap('{{ c.context.geoposition | slice(1, c.context.geoposition |length-2 ) }}');" style="cursor: pointer; cursor: hand;"> {{ c.context.description -}} </a>
										{%- endif %}
										{%- if c.pertinencePosition.description != 'n.d.'-%}
											, {{ c.pertinencePosition.description -}}
										{%- endif %}
										{% if c.pertinenceArea.description != 'n.d.' -%}
											({{ c.pertinenceArea.description -}})
										{%- endif -%}
										{%- if c.inSitu == true -%}
											, in situ 
										{%- endif -%} 
									</td> 
								</tr>
							{% endfor %}
						{% endif %}				
						{% if e.material.support.id != 0 or e.material.technique.id != 0 or e.material.height != '' or e.material.width != '' or e.material.tickness != '' or e.altMaxLetters != '' or e.altMinLetters != ''%}
							<tr style = "font-size: 12pt">
								<td>
									{%- if e.material.support.id != 0 -%}
										{{- e.material.support.description }}
										{%- if e.material.technique.id != 0 -%}
											-
										{%- endif -%}
									{%- endif -%}
									{%- if e.material.technique.id != 0 -%}
										Titulus {{ e.material.technique.description-}}
									{%- endif -%}
									{%- if (e.material.height != '' or e.material.width != '' or e.material.tickness != '') and (e.material.technique.id != 0 or e.material.support.id != 0) -%}
										, 
									{% endif %}
									{%- if e.material.height != '' or e.material.width != '' or e.material.tickness != '' -%}
										{% if e.material.height != '' -%} 
											{{- e.material.height -}} 
										{%- else -%} 
											? 
										{%- endif %} 
										x 
										{% if e.material.width != '' -%} 
											{{- e.material.width -}} 
										{%- else -%} 
											? 
										{%- endif %}  
										x 
										{% if e.material.tickness != '' -%}
											{{- e.material.tickness -}} 
										{%- else -%} 
											? 
										{%- endif -%}
									{%- endif -%}
									{%- if e.altMaxLetters != '' or e.altMinLetters != '' -%}
										. Letters  
										{% if e.altMaxLetters != '' and e.altMinLetters != '' -%}	
											({{- e.altMinLetters -}}-{{- e.altMaxletters -}})
										{%- elseif e.altMaxLetters != '' -%}
											{{- e.altMaxLetters -}}
										{%- elseif e.altMinLetters != '' -%}
											{{- e.altMinLetters -}}
										{%- endif -%}
									{%- endif -%}
								</td>
							</tr>
						{% endif %}
						{% if e.lost == 'S' %}
							<tr style = "font-size: 12pt">
								<td> Lost </td> 
							</tr>
						{% elseif e.conservations | length > 0 %}
							{% for c in e.conservations if c.conservationLocation.description != 'n.d.' %}
								<tr style = "font-size: 12pt">
									<td> 
										<i style="color:grey;">
										{%- if loop.index == 1 -%}
											Now in 
										{% else -%}
											and  
										{% endif -%}
										</i>
										{{- c.conservationLocation.description -}}
										{%- if c.conservationContext.description != 'n.d.' -%}
											, {{ c.conservationContext.description -}}
										{%- endif -%}
										{%- if c.conservationPosition.description != 'n.d.' -%}
											, {{ c.conservationPosition.description -}}
										{%- endif -%}
									</td> 
								<tr>
							{% endfor %}
						{% endif %}
						
						<tr style = "font-size: 12pt">
							<td>
								{{ e.funzione.description }}
							</td>
						</tr>
						
						{% set datings_present = false %}
						{%- for c in e.datings -%}
							{%- if(c.from != 'n.d.') -%}
								{%-  set datings_present = true -%}
							{%- endif -%}
						{%- endfor -%}
						{%- if datings_present -%}<tr style = "font-size: 12pt"><td><i style="color:grey;">Date: </i> 
							{%- for c in e.datings -%}
								{%- if c.from != 'n.d.' -%}
									{%- if loop.index > 1 %}; {% endif %}
									{%- if c.from == c.to -%}
										{{- c.from -}}
									{%- else -%} 
										{{- c.from -}}-{{- c.to -}}
									{%- endif -%}
								{%- endif -%}
							{%- endfor -%}</td></tr>	
						{%- endif -%}
						
						
						{% set identity = [] %}
						{% set opistographic = [] %}
						{% set reuse = [] %}
						{% set integration = [] %}
						{% for lit in e.literatures %}
							{% if lit.relazione == 'Identity' %}
								{% set identity = identity | merge([lit]) %}
							{% elseif lit.relazione == 'Opistographic' %}
								{% set opistographic = opistographic | merge([lit]) %}
							{% elseif lit.relazione == 'Reuse' %}
								{% set reuse = reuse | merge([lit]) %}
							{% elseif lit.relazione == 'Integration' %}
								{% set integration = integration | merge([lit]) %}
							{% endif %}
						{% endfor %}
							
						{% set identity_online = [] %}
						{% set opistographic_online = [] %}
						{% set reuse_online = [] %}
						{% set integration_online = [] %}
						{% for lit in e.relatedResources %}
							{% if lit.relationType == 'Identity' %}
								{% set identity_online = identity_online | merge([lit]) %}
							{% elseif lit.relationType == 'Opistographic' %}
								{% set opistographic_online = opistographic_online | merge([lit]) %}
							{% elseif lit.relationType == 'Reuse' %}
								{% set reuse_online = reuse_online | merge([lit]) %}
							{% elseif lit.relationType == 'Integration' %}
								{% set integration_online = integration_online | merge([lit]) %}
							{% endif %}
						{% endfor %}
						
						<tr style = "font-size: 12pt">
							<td><i style="color:grey;">Bibliography:</i> 
							{% if e.icvr != '' and e.icvr != 'n.d.' %}
								ICVR {{ e.icvr -}}, {{ e.principalProgNumber -}}
								{%- if e.subNumeration != 'n.d.' and e.subNumeration != '' -%}
									.{{- e.subNumeration -}}
								{%- endif -%}
							{%- endif -%}
							{%- if identity | length > 0 -%}
								{%- for b in identity -%}
									{%- if loop.index > 1 or (e.icvr != '' and e.icvr != 'n.d.') -%}; 
									{% endif -%}
									<a onClick="showRef('{{ b.idRiferimento.id }}');" style="cursor: pointer; cursor: hand;">{{- b.idRiferimento.id -}}
									{%- if b.note != '' -%},
									 	{{ b.note -}}
									{%- endif -%}
									 </a>
								{%- endfor -%}
							{%- endif -%}
							{%- if identity_online | length > 0 -%}
								{%- for b in identity_online -%}
									{%- if loop.index > 1 or (identity | length > 0) -%};{% endif -%}
									<a href = "{{b.resourceType.reference}}
									{%- if b.resourceType.idSize and b.resourceType.idSize-b.resourceRef|length > 0 -%}
										{%- for i in 1..b.resourceType.idSize-b.resourceRef|length -%}0{%- endfor -%}
									{%- endif -%}
									{{ b.resourceRef }}" target="_blank">{{ b.resourceType.description -}}{{- b.resourceRef }}</a>
								{%- endfor -%}
							{%- endif -%}
							</td>
						</tr>
						
												
						{%- if opistographic | length > 0 or opistographic_online | length > 0-%}
							<tr style = "font-size: 10pt">
								<td><i style="color:grey;">Other text(s) on the back side:</i> 
						{% endif %}
						{%- if opistographic | length > 0 -%}
							{%- for b in opistographic -%}
								{%- if loop.index > 1 -%}; {% endif -%}
								<a onClick="showRef('{{ b.idRiferimento.id }}');" style="cursor: pointer; cursor: hand;">{{- b.idRiferimento.id -}} 
								{%- if b.note != '' -%},
								 	{{ b.note -}}
								{%- endif -%}
								</a>
							{%- endfor -%}
						{%- endif -%}
						{%- if opistographic_online | length > 0 -%}
							{%- for b in opistographic_online -%}
								{%- if loop.index > 1 or (opistographic | length > 0) -%}; 
								{% endif -%}
								<a href = "{{b.resourceType.reference}}
								{%- if b.resourceType.idSize and b.resourceType.idSize-b.resourceRef|length > 0 -%}
									{%- for i in 1..b.resourceType.idSize-b.resourceRef|length -%}0{%- endfor -%}
								{%- endif -%}
								{{ b.resourceRef }}" target="_blank">{{ b.resourceType.description -}}{{- b.resourceRef }}</a>
							{%- endfor -%}
						{%- endif -%}
						{%- if opistographic | length > 0 or opistographic_online | length > 0-%}
							</td>
						</tr>
						{% endif %}
						
						
						{%- if reuse | length > 0 or reuse_online | length > 0-%}
							<tr style = "font-size: 10pt">
								<td><i style="color:grey;">Other text(s) on the same support:</i> 
						{% endif %}
						{%- if reuse | length > 0 -%}
							{%- for b in reuse -%}
								{%- if loop.index > 1 -%}; {% endif -%}
								<a onClick="showRef('{{- b.idRiferimento.id -}}');" style="cursor: pointer; cursor: hand;">{{- b.idRiferimento.id -}} 
								{%- if b.note != '' -%},
									 {{ b.note -}}
								{%- endif -%}			
								</a>
							{%- endfor -%}
						{%- endif -%}
						{%- if reuse_online | length > 0 -%}
							{%- for b in reuse_online -%}
								{%- if loop.index > 0 or (reuse | length > 0) -%}; 
								{% endif -%}
								<a href = "{{b.resourceType.reference}}
								{%- if b.resourceType.idSize and b.resourceType.idSize-b.resourceRef|length > 0 -%}
									{%- for i in 1..b.resourceType.idSize-b.resourceRef|length -%}0{%- endfor -%}
								{%- endif -%}
								{{ b.resourceRef }}" target="_blank">{{ b.resourceType.description -}}{{- b.resourceRef }}</a>
							{%- endfor -%}
						{%- endif -%}
						{%- if reuse | length > 0 or reuse_online | length > 0-%}
							</td>
						</tr>
						{% endif %}
						
						{%- if integration | length > 0 or integration_online | length > 0-%}
							<tr style = "font-size: 10pt">
								<td><i style="color:grey;">To be joined with:</i> 
						{% endif %}
						{%- if integration | length > 0 -%}
							{%- for b in integration -%}
								{%- if loop.index > 1 -%}; 
								{% endif -%}
								<a onClick="showRef('{{ b.idRiferimento.id }}');" style="cursor: pointer; cursor: hand;">{{- b.idRiferimento.id -}} 
								{%- if b.note != '' -%},
									{{ b.note -}}
								{%- endif -%}
								</a>
							{%- endfor -%}
						{%- endif -%}
						{%- if integration_online | length > 0 -%}
							{%- for b in integration_online -%}
								{%- if i > 0 or (integration | length > 0) -%}; 
								{% endif -%}
								<a href = "{{b.resourceType.reference}}
								{%- if b.resourceType.idSize and b.resourceType.idSize-b.resourceRef|length > 0 -%}
									{%- for i in 0..(b.resourceType.idSize-b.resourceRef|length) -%}0{%- endfor -%}
								{%- endif -%}
								{{ b.resourceRef }}" target="_blank">{{ b.resourceType.description -}}{{- b.resourceRef }}</a>
							{%- endfor -%}
						{%- endif -%}
						{%- if integration | length > 0 or integration_online | length > 0-%}
							</td>
						</tr>
						{% endif %}
						
							
						
						
						{% if imageUrl != null %}
							<tr><td></td></tr>
							<tr>
						 		<td>
						 			<div class = "image">
						 				<img src = {{ imageUrl }} width = 370px><br>
						 				<p style="color:grey; font-size: 9pt"><a href ="http://www.archeologiasacra.net/pcas-web/EDB/{{- e.id -}}/scheda.html"><strong>Other image(s) available at ©Archivio della Pontificia Commissione <br> di Archeologia Sacra</strong></a></p> 
						 			</div>
								</td>
							</tr>						
						{% endif %}	
						<tr><td></td></tr>
						
						<tr><td style = "line-height: 1.8; font-family:Cardo; font-size: 16pt"> {{ e.trascription | replace({' /' : '<br>'}) | replace({'/' : '-<br>'})| raw }} </td></tr>
						
						<tr><td><br></td></tr>
						<tr>
							<td>
							{% if e.divergentText == 'S' or e.divergentText == '1' %}
								Transcription different from ICVR. 
							{% endif %}
							{% if e.criticalApparatus != 'n.d.' and e.criticalApparatus != '' %}
								{{ e.criticalApparatus -}}.
							{% endif %}
							</td>
						</tr>
						<tr><td></td></tr>
						<tr>
							<td style="color:grey;">
								{{ e.oldCompilator -}} 
								{%- if e.createdAt != '' and e.createdAt != 'n.d.' -%}
									, {{ e.createdAt | date('d/m/Y') }}
								{% endif %}
							</td>
						</tr>
						{% if e.createdAt | date('d/m/Y') != e.editedAt | date('d/m/Y') and e.compilator != e.lastCompilator and e.lastCompilator != '' %}
							<tr>
								<td style="color:grey; font-size: 9pt">	
									Last update by {{ e.lastCompilator.firstname }} {{ e.lastCompilator.lastname }} on {{ e.editedAt | date('d/m/Y')  }}
								</td>
							</tr>
								{% endif %}
							</td>
						</tr>
				</table>
	</div>
	<div class="row"></div> 		
{% endblock %}
{% block javascripts %}
		{{ parent() }}
		<script src="{{ asset('js/show.js') }}" type="text/javascript"></script>
{% endblock %}
